<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VitalGuard - Dashboard</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
body { background:#F0F4F8; color:#1F2937; overflow-x:hidden; }

/* Sidebar */
.sidebar {
  position: fixed; top:0; left:0; width:220px; height:100vh; background:#1E3A8A; color:#fff; padding:20px;
  display:flex; flex-direction:column; transition:0.3s; box-shadow:2px 0 6px rgba(0,0,0,0.1); z-index:1000;
}
.sidebar h1 { font-size:1.6rem; margin-bottom:25px; color:#fff; text-align:center; letter-spacing:1px; }
.sidebar a { display:flex; align-items:center; gap:12px; padding:12px 10px; border-radius:12px; color:#D1D5DB; text-decoration:none; font-weight:500; transition:0.3s; margin-bottom:12px; }
.sidebar a:hover { background:#2563EB; color:#fff; box-shadow:0 4px 10px rgba(0,0,0,0.2);}
.sidebar a.active { background:#2563EB; color:#fff; box-shadow:0 4px 10px rgba(0,0,0,0.2);}
.sidebar hr { margin:25px 0; border-color:#3B82F6; }

/* Header */
.header { 
  position: sticky; top:0; 
  margin-left:220px; height:60px; background:#fff; display:flex; justify-content:space-between; align-items:center; 
  padding: 25px; box-shadow:0 2px 8px rgba(0,0,0,0.1); z-index:999;
}
.header h2 { font-size:1.4rem; font-weight:600; color:#1E3A8A; }
.header .buttons { display: flex; gap: 12px; align-items: center; }
.header .buttons div { font-size: 1.3rem; padding: 6px; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
.header .buttons div:hover { background: rgba(30,58,138,0.1); }

/* Main */
.main { margin-left:220px; padding:25px; overflow:hidden; }

/* Cards */
.cards { display:flex; flex-wrap:wrap; gap:20px; margin-bottom:25px; }
.card { flex:1 1 230px; padding:25px; border-radius:16px; color:#fff; display:flex; flex-direction:column; gap:15px; box-shadow:0 6px 15px rgba(0,0,0,0.12); transition:0.3s; }
.card:hover { transform:none; box-shadow:0 12px 25px rgba(0,0,0,0.18); }
.card h3 { font-size:1.7rem; font-weight:700; display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.card p { font-size:1rem; color:rgba(255,255,255,0.9); }
.card .icon { font-size:36px; }
.badge { font-size:0.75rem; padding:3px 6px; background:rgba(255,255,255,0.3); border-radius:8px; }

/* Card colors */
.bpm { background:#10B981; }
.falls { background:#FBBF24; }
.alerts { background:#EF4444; }
.bracelets { background:#3B82F6; }

/* Graphs flex */
.graphs { display:flex; gap:20px; flex-wrap:wrap; margin-top:20px; height:400px; }
.chart-small { flex:1 1 35%; background:#fff; border-radius:16px; padding:20px; display:flex; flex-direction:column; box-shadow:0 6px 15px rgba(0,0,0,0.08); }
.chart-large { flex:1 1 60%; background:#fff; border-radius:16px; padding:20px; display:flex; flex-direction:column; box-shadow:0 6px 15px rgba(0,0,0,0.08); }

/* Carte */
#map { width:100%; flex:1; border-radius:16px; }

/* Vital AI */
#vitalAI { position: fixed; bottom:20px; right:20px; background:#1E3A8A; color:#fff; padding:12px 18px; border-radius:50px; cursor:pointer; display:flex; align-items:center; gap:8px; box-shadow:0 6px 15px rgba(0,0,0,0.2); z-index:2000; }
#vitalAI:hover { background:#2563EB; }

/* Chatbot AI */
#chatbot { position: fixed; bottom:80px; right:20px; width:320px; max-height:500px; background:#fff; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,0.2); display:none; flex-direction:column; overflow:hidden; font-family:'Poppins', sans-serif; z-index:2000; transition:0.3s;}
#chatbot-header { background:#1E3A8A; color:#fff; padding:12px; font-weight:600; display:flex; align-items:center; gap:8px; cursor:pointer; }
#chatbot-messages { flex:1; padding:10px; overflow-y:auto; background:#f5f5f5; }
.message { margin-bottom:10px; display:flex; flex-direction:column; }
.message.user { align-items:flex-end; }
.message.user .text { background:#10B981; color:#fff; border-radius:12px 12px 0 12px; }
.message.ai .text { background:#3B82F6; color:#fff; border-radius:12px 12px 12px 0; }
.text { padding:8px 12px; max-width:80%; }
#chatbot-input { display:flex; border-top:1px solid #ddd; }
#chatbot-input input { flex:1; border:none; padding:10px; font-size:0.95rem; outline:none; }

/* Responsive */
@media(max-width:1024px){ .graphs { flex-direction:column; height:auto; } .chart-small,.chart-large{flex:1 1 100%;} }
@media(max-width:768px){
  .sidebar { width:60px; padding:15px; }
  .sidebar h1, .sidebar a span { display:none; }
  .header { margin-left:60px; padding:0 15px; }
  .main { margin-left:60px; padding:15px; }
  .cards { flex-direction:column; }
}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <h1>VitalGuard</h1>
  <a href="#" class="active"><i class="fa-solid fa-house"></i> <span>Dashboard</span></a>
  <a href="#"><i class="fa-solid fa-user-injured"></i> <span>Patients</span></a>
  <a href="#"><i class="fa-solid fa-triangle-exclamation"></i> <span>Alertes <span class="badge">1</span></span></a>
  <a href="#"><i class="fa-solid fa-chart-line"></i> <span>Historique</span></a>
  <hr>
  <a href="#"><i class="fa-solid fa-gear"></i> <span>Paramètres</span></a>
</div>

<!-- Header -->
<div class="header">
  <h2>Vue générale</h2>
  <div class="buttons">
    <div><i class="fa-solid fa-bell"></i></div>
    <div><i class="fa-solid fa-message"></i></div>
    <div><i class="fa-solid fa-circle-half-stroke"></i></div>
  </div>
</div>

<!-- Main -->
<div class="main">
  <!-- Cards -->
  <div class="cards">
    <div class="card bpm">
      <h3><i class="fa-solid fa-heart-pulse icon"></i> 72 BPM <span class="badge">+2%</span></h3>
      <p>Rythme cardiaque moyen</p>
    </div>
    <div class="card falls">
      <h3><i class="fa-solid fa-person-falling icon"></i> 3 <span class="badge">-1</span></h3>
      <p>Chutes détectées aujourd'hui</p>
    </div>
    <div class="card bracelets">
      <h3><i class="fa-solid fa-temperature-full"></i> 24</h3>
      <p>Température du corps</p>
    </div>
    <div class="card alerts">
      <h3><i class="fa-solid fa-circle-exclamation icon"></i> 1 <span class="badge">Nouvelle</span></h3>
      <p>Alertes SOS actives</p>
    </div>
  </div>

  <!-- Graphs et carte -->
  <div class="graphs">
    <div class="chart-small">
      <h3>Localisation actuelle</h3>
      <div id="map"></div>
    </div>
    <div class="chart-large">
      <h3>Statistiques hebdomadaires</h3>
      <canvas id="weeklyChart"></canvas>
    </div>
  </div>
</div>

<!-- Vital AI -->
<div id="vitalAI"><i class="fa-solid fa-robot"></i> <span>Vital</span></div>

<!-- Chatbot AI -->
<div id="chatbot">
  <div id="chatbot-header"><i class="fa-solid fa-robot"></i> Assistant AI</div>
  <div id="chatbot-messages"></div>
  <div id="chatbot-input">
    <input type="text" id="userMessage" placeholder="Posez une question sur le patient..." />
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Graphique BPM + Chutes
const ctxWeekly = document.getElementById('weeklyChart').getContext('2d');
const bpmToday = 72;
const fallsToday = 3;
const bpmData = Array(7).fill().map((_,i)=> Math.round(bpmToday + (Math.random()*4-2)));
const fallsData = Array(7).fill().map((_,i)=> Math.round(fallsToday + (Math.random()*2-1)));

new Chart(ctxWeekly, {
  type:'line',
  data:{
    labels:['Lun','Mar','Mer','Jeu','Ven','Sam','Dim'],
    datasets:[
      { label:'BPM', data:bpmData, borderColor:'#10B981', backgroundColor:'rgba(16,185,129,0.2)', tension:0.4, fill:true, pointRadius:6, pointHoverRadius:8, borderWidth:3 },
      { label:'Chutes détectées', data:fallsData, borderColor:'#FBBF24', backgroundColor:'rgba(251,191,36,0.2)', tension:0.4, fill:true, pointRadius:6, pointHoverRadius:8, borderWidth:3 }
    ]
  },
  options:{ responsive:true, plugins:{ legend:{ position:'top', labels:{boxWidth:20, padding:15} } }, scales:{ y:{ beginAtZero:true } } }
});

// Carte Agadir
const latAgadir = 30.4278 + (Math.random()-0.5)*0.01;
const lngAgadir = -9.5981 + (Math.random()-0.5)*0.01;
const map = L.map('map').setView([latAgadir,lngAgadir],14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(map);
L.marker([latAgadir,lngAgadir]).addTo(map).bindPopup("Position simulée à Agadir").openPopup();

// Chatbot AI
const vitalBtn = document.getElementById('vitalAI');
const chatbot = document.getElementById('chatbot');
const chatbotHeader = document.getElementById('chatbot-header');
const messagesDiv = document.getElementById('chatbot-messages');
const userInput = document.getElementById('userMessage');

function addMessage(text,sender){
  const msgDiv = document.createElement('div');
  msgDiv.classList.add('message',sender);
  const textDiv = document.createElement('div');
  textDiv.classList.add('text');
  textDiv.textContent = text;
  msgDiv.appendChild(textDiv);
  messagesDiv.appendChild(msgDiv);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Ouvrir/fermer chat avec Vital
vitalBtn.addEventListener('click', ()=>{
  if(chatbot.style.display==='flex') chatbot.style.display='none';
  else {
    chatbot.style.display='flex';
    if(messagesDiv.children.length === 0){
      addMessage("Bonjour ! Je suis Vital, votre assistant AI. Comment puis-je vous aider avec le patient aujourd'hui ?",'ai');
    }
  }
});

// Fermer chat en cliquant sur header
chatbotHeader.addEventListener('click', ()=>{ chatbot.style.display='none'; });

// Envoyer message uniquement avec Enter
userInput.addEventListener('keydown', e=>{
  if(e.key==='Enter'){
    const text = userInput.value.trim();
    if(!text) return;
    addMessage(text,'user');
    userInput.value='';
    
    setTimeout(()=>{
      let response = "Je peux fournir des infos sur le BPM, les chutes, les bracelets connectés et les tendances hebdomadaires.";
      const t = text.toLowerCase();
      if(t.includes("bpm")) response = `Le rythme cardiaque moyen est ${bpmToday} BPM.`;
      if(t.includes("chute")) response = `Nombre de chutes aujourd'hui: ${fallsToday}. Les jours précédents: ${fallsData.join(', ')}.`;
      if(t.includes("bracelet")) response = "Bracelets connectés: 24. Tous fonctionnent correctement.";
      if(t.includes("tendance") || t.includes("évolution")) response = `Tendance BPM cette semaine: ${bpmData.join(', ')}. Chutes: ${fallsData.join(', ')}.`;
      addMessage(response,'ai');
    },700);
  }
});
</script>
</body>
</html>
